#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

set -e

# Error handler to display a helpful message on failure
on_error() {
  echo "❌ Pre-commit failed${CURRENT_STEP:+ at step: $CURRENT_STEP}"
  exit 1
}
trap 'on_error' ERR

echo "🔍 Running pre-commit checks..."
echo "⏳ Checking ESLint and Prettier rules..."

CURRENT_STEP="lint-staged"
pnpm exec lint-staged
CURRENT_STEP=""

echo "🧪 Running all tests..."
CURRENT_STEP="tests"
pnpm exec jest
CURRENT_STEP=""

echo "✅ Pre-commit checks passed successfully."
